# Модуль экспорта DD групп в формат drawio

Этот модуль позволяет экспортировать дерево групп DD (Deployment Diagram) в формат drawio XML.

## Функциональность

- Экспорт всех корневых групп DD в один файл drawio
- Экспорт конкретной группы DD и всех её дочерних элементов
- Автоматический расчет размеров и позиций элементов
- Поддержка вложенных структур (дочерние элементы внутри родительских)
- Корректное отображение данных группы (название, количество экземпляров, спецификация)

## API Эндпоинты

### 1. Экспорт всех корневых групп DD
```
GET /api/dd-groups/export/drawio
```

Экспортирует все корневые группы DD (группы без родителя) в один файл drawio.

**Ответ:** XML файл с расширением `.drawio`

### 2. Экспорт конкретной группы DD
```
GET /api/dd-groups/{dd_group_id}/export/drawio
```

Экспортирует конкретную группу DD и все её дочерние элементы.

**Параметры:**
- `dd_group_id` (int) - ID группы DD для экспорта

**Ответ:** XML файл с расширением `.drawio`

## Использование в коде

```python
from architecture.drawio_export import DrawioExporter

# Создание экспортера
exporter = DrawioExporter()

# Экспорт всех корневых групп
xml_content = exporter.export_dd_groups_to_drawio()

# Экспорт конкретной группы
xml_content = exporter.export_dd_groups_to_drawio(root_group_id=1)

# Сохранение в файл
with open('export.drawio', 'w', encoding='utf-8') as f:
    f.write(xml_content)
```

## Формат отображения

Каждая группа DD отображается как компонент с следующими данными:
- **c4Name** = `ddgroup.name`
- **c4Instances** = `ddgroup.instances` (если instances = 0, то отображается как 'n')
- **c4Specifications** = `ddgroup.specification`

## Алгоритм расположения

1. **Корневые элементы** размещаются горизонтально с отступом 50px между ними
2. **Дочерние элементы** размещаются внутри родительских с отступом 20px от краев
3. **Размеры** рассчитываются автоматически на основе содержимого:
   - Минимальная ширина: 240px
   - Минимальная высота: 120px
   - Размер увеличивается для размещения всех дочерних элементов

## Тестирование

Для тестирования функциональности запустите:

```bash
cd backend
python architecture/test_drawio_export.py
```

Этот скрипт создаст тестовые данные и сгенерирует файлы drawio для проверки.

## Структура XML

Экспортированный XML соответствует стандартному формату drawio и может быть открыт в:
- draw.io (app.diagrams.net)
- VS Code с расширением Draw.io Integration
- Любом другом редакторе, поддерживающем формат drawio

## Примечания

- Если группа не имеет спецификации, используется значение по умолчанию "Type\nSpecifications"
- Если количество экземпляров равно 0 или не указано, отображается как 'n'
- Дочерние элементы автоматически позиционируются внутри родительских элементов
- Размеры элементов рассчитываются динамически для предотвращения наложения 